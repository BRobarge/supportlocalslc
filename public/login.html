<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login / Sign Up â€” SupportLocalSLC</title>
    <link href="/shared/output.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body class="bg-white font-sans text-slate-900">
    <!-- ============================================================= -->
    <!-- HEADER (matches new Index layout)                             -->
    <!-- ============================================================= -->
    <header class="bg-white shadow-md sticky top-0 z-40">
        <div class="container mx-auto px-6 py-3">
            <div class="flex items-center">
                <!-- Logo -->
                <a href="/" class="flex-shrink-0">
                    <img class="h-12 w-auto"
                        src="https://kozlfywdsqjndcsibgtw.supabase.co/storage/v1/object/public/business-logos/Site%20Assets/Top%20Logo.png"
                        alt="SupportLocalSLC Logo">
                </a>
    
                <!-- Desktop Nav (right-aligned) -->
                <nav id="desktop-nav" class="hidden lg:flex items-center space-x-8 ml-auto">
                    <div class="relative dropdown">
                        <a href="#" class="dropdown-toggle text-gray-600 hover:text-blue-600 font-semibold"
                            data-toggle="dropdown">
                            Directory <i class="fas fa-chevron-down text-xs ml-1"></i>
                        </a>
                        <div class="dropdown-menu hidden absolute mt-2 w-48 bg-white rounded-lg shadow-xl py-2">
                            <a href="/sandy/index.html" class="block px-4 py-2 text-gray-700 hover:bg-blue-50">Sandy</a>
                            <span class="block px-4 py-2 text-gray-400 cursor-not-allowed">Draper (Soon)</span>
                        </div>
                    </div>
    
                    <div class="relative dropdown">
                        <a href="#" class="dropdown-toggle text-gray-600 hover:text-blue-600 font-semibold"
                            data-toggle="dropdown">
                            Offers <i class="fas fa-chevron-down text-xs ml-1"></i>
                        </a>
                        <div class="dropdown-menu hidden absolute mt-2 w-56 bg-white rounded-lg shadow-xl py-2">
                            <a href="/sandy/index.html?filter=offers"
                                class="block px-4 py-2 text-gray-700 hover:bg-blue-50">Sandy Offers</a>
                            <span class="block px-4 py-2 text-gray-400 cursor-not-allowed">Draper Offers (Soon)</span>
                        </div>
                    </div>
    
                    <a href="/#for-business" class="text-gray-600 hover:text-blue-600 font-semibold">For Business Owners</a>
    
                    <!-- Login/Dashboard -->
                    <a id="auth-link" href="/login.html"
                        class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700">Login</a>
                </nav>
    
                <!-- Mobile hamburger -->
                <button id="mobile-menu-btn" class="lg:hidden ml-auto text-gray-600 hover:text-gray-800 focus:outline-none">
                    <i class="fas fa-bars text-2xl"></i>
                </button>
            </div>
    
            <!-- Mobile Menu -->
            <nav id="mobile-menu" class="lg:hidden hidden mt-4 w-64 ml-auto text-right">
                <div class="dropdown">
                    <a href="#" class="dropdown-toggle block py-2 text-gray-700 font-semibold" data-toggle="dropdown">
                        Directory <i class="fas fa-chevron-down text-xs ml-1"></i>
                    </a>
                    <div class="dropdown-menu hidden pl-4">
                        <a href="/sandy/index.html" class="block py-2 text-gray-600">Sandy</a>
                        <span class="block py-2 text-gray-400 cursor-not-allowed">Draper (Soon)</span>
                    </div>
                </div>
                <div class="dropdown">
                    <a href="#" class="dropdown-toggle block py-2 text-gray-700 font-semibold" data-toggle="dropdown">
                        Offers <i class="fas fa-chevron-down text-xs ml-1"></i>
                    </a>
                    <div class="dropdown-menu hidden pl-4">
                        <a href="/sandy/index.html?filter=offers" class="block py-2 text-gray-600">Sandy Offers</a>
                        <span class="block py-2 text-gray-400 cursor-not-allowed">Draper (Soon)</span>
                    </div>
                </div>
                <a href="/#for-business" class="block py-2 text-gray-700 font-semibold">For Business Owners</a>
                <hr class="my-2" />
                <a id="mobile-auth-link" href="/login.html" class="block py-2 text-gray-700 font-semibold">Login</a>
            </nav>
        </div>
    </header>

    <!-- ============================================================= -->
    <!-- MAIN AUTH CARD                                                -->
    <!-- ============================================================= -->
    <main class="container mx-auto px-6 py-10">
        <section class="max-w-xl mx-auto bg-white rounded-2xl shadow p-6 sm:p-8">
            <!-- Tabs -->
            <div class="flex rounded-xl bg-slate-100 p-1 mb-6" role="tablist" aria-label="Auth tabs">
                <button id="tab-login" role="tab" aria-selected="true" aria-controls="panel-login"
                    class="flex-1 rounded-lg py-2.5 text-sm font-semibold bg-white shadow">Login</button>
                <button id="tab-signup" role="tab" aria-selected="false" aria-controls="panel-signup"
                    class="flex-1 rounded-lg py-2.5 text-sm font-semibold text-slate-600">Create account</button>
            </div>

            <!-- Messages -->
            <div id="success-message"
                class="hidden mb-4 rounded-lg border border-green-200 bg-green-50 text-green-800 px-3 py-2 text-sm">
            </div>
            <div id="error-message"
                class="hidden mb-4 rounded-lg border border-red-200 bg-red-50 text-red-800 px-3 py-2 text-sm"></div>

            <!-- LOGIN PANEL -->
            <form id="panel-login" role="tabpanel" aria-labelledby="tab-login" class="space-y-4">
                <label class="block">
                    <span class="text-sm font-medium">Email</span>
                    <input id="login-email" type="email" autocomplete="email"
                        class="mt-1 w-full rounded-lg border border-slate-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-blue-600"
                        required />
                </label>
                <label class="block">
                    <span class="text-sm font-medium">Password</span>
                    <div class="mt-1 relative">
                        <input id="login-password" type="password" autocomplete="current-password"
                            class="w-full rounded-lg border border-slate-300 p-2.5 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-600"
                            required />
                        <button type="button" id="login-toggle-pass"
                            class="absolute inset-y-0 right-0 px-3 text-slate-500" aria-label="Show password"><i
                                class="far fa-eye"></i></button>
                    </div>
                </label>
                <!-- Keep your preferred button color -->
                <button type="submit"
                    class="w-full rounded-lg bg-blue-900 text-yellow-300 font-semibold py-2.5 hover:bg-blue-800">Login</button>
                <div class="flex items-center justify-between text-sm">
                    <button type="button" id="forgot" class="underline">Forgot password?</button>
                </div>
                <div class="pt-2">
                    <button type="button" id="login-google"
                        class="w-full rounded-lg border border-slate-300 py-2.5 text-sm font-semibold hover:bg-slate-50 flex items-center justify-center gap-2">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt=""
                            class="w-5 h-5" />
                        Continue with Google
                    </button>
                </div>
            </form>

            <!-- SIGNUP PANEL -->
            <form id="panel-signup" role="tabpanel" aria-labelledby="tab-signup" class="space-y-4 hidden">
                <p class="text-sm text-slate-600">All accounts start as <strong>Supporters</strong>. You can claim a
                    business later inside your dashboard.</p>
                <label class="block">
                    <span class="text-sm font-medium">Email</span>
                    <input id="signup-email" type="email" autocomplete="email"
                        class="mt-1 w-full rounded-lg border border-slate-300 p-2.5 focus:outline-none focus:ring-2 focus:ring-blue-600"
                        required />
                </label>
                <label class="block">
                    <span class="text-sm font-medium">Password</span>
                    <div class="mt-1 relative">
                        <input id="signup-password" type="password" autocomplete="new-password"
                            class="w-full rounded-lg border border-slate-300 p-2.5 pr-10 focus:outline-none focus:ring-2 focus:ring-blue-600"
                            required />
                        <button type="button" id="signup-toggle-pass"
                            class="absolute inset-y-0 right-0 px-3 text-slate-500" aria-label="Show password"><i
                                class="far fa-eye"></i></button>
                    </div>
                </label>
                <button type="submit"
                    class="w-full rounded-lg bg-blue-900 text-yellow-300 font-semibold py-2.5 hover:bg-blue-800">Create
                    account</button>
                <div class="pt-2">
                    <button type="button" id="signup-google"
                        class="w-full rounded-lg border border-slate-300 py-2.5 text-sm font-semibold hover:bg-slate-50 flex items-center justify-center gap-2">
                        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt=""
                            class="w-5 h-5" />
                        Sign up with Google
                    </button>
                </div>
            </form>
        </section>
    </main>

    <!-- ============================================================= -->
    <!-- FOOTER (matches new Index layout)                             -->
    <!-- ============================================================= -->
    <footer class="bg-gray-800 text-gray-400">
        <div class="container mx-auto px-6 py-16">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-12">
                <div class="md:col-span-1">
                    <img src="https://kozlfywdsqjndcsibgtw.supabase.co/storage/v1/object/public/business-logos/Site%20Assets/Top%20Logo.png"
                        alt="SupportLocalSLC Logo" class="h-10 mb-4" />
                    <p class="text-sm">Your guide to the best local spots in Salt Lake County.</p>
                </div>
                <div class="md:col-span-3 grid grid-cols-2 md:grid-cols-3 gap-8">
                    <div>
                        <h4 class="font-semibold text-white mb-4">Navigate</h4>
                        <ul class="space-y-3 text-sm">
                            <li><a href="/" class="hover:text-white">Home</a></li>
                            <li><a href="/sandy/index.html" class="hover:text-white">Directory</a></li>
                            <li><a href="/#for-business" class="hover:text-white">For Business Owners</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white mb-4">Legal</h4>
                        <ul class="space-y-3 text-sm">
                            <li><a href="/terms.html" class="hover:text-white">Terms of Service</a></li>
                            <li><a href="/privacy.html" class="hover:text-white">Privacy Policy</a></li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-white mb-4">Connect</h4>
                        <div class="flex space-x-4">
                            <a href="#" class="text-xl hover:text-white"><i class="fab fa-facebook-f"></i></a>
                            <a href="#" class="text-xl hover:text-white"><i class="fab fa-instagram"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mt-12 border-t border-gray-700 pt-8 text-center text-sm">
                <p>&copy; 2025 SupportLocalSLC. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <!-- ============================================================= -->
    <!-- SCRIPT                                                         -->
    <!-- ============================================================= -->
    <script type="module">
        // Supabase
        const supabaseUrl = 'https://kozlfywdsqjndcsibgtw.supabase.co'
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtvemxmeXdkc3FqbmRjc2liZ3R3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTIyNTk0NzEsImV4cCI6MjA2NzgzNTQ3MX0.Xb0nRQIVhpW_7uBcwfIuvGZmyPMGzJq6k-6fdgfF3kw'
        const supabaseClient = supabase.createClient(supabaseUrl, supabaseAnonKey)

        // Tabs
        const tabLogin = document.getElementById('tab-login')
        const tabSignup = document.getElementById('tab-signup')
        const panelLogin = document.getElementById('panel-login')
        const panelSignup = document.getElementById('panel-signup')
        function setTab(which) {
            const isLogin = which === 'login'
            tabLogin.setAttribute('aria-selected', isLogin)
            tabSignup.setAttribute('aria-selected', !isLogin)
            tabLogin.classList.toggle('bg-white', isLogin)
            tabLogin.classList.toggle('text-slate-600', !isLogin)
            tabLogin.classList.toggle('shadow', isLogin)
            tabSignup.classList.toggle('bg-white', !isLogin)
            tabSignup.classList.toggle('text-slate-600', isLogin)
            tabSignup.classList.toggle('shadow', !isLogin)
            panelLogin.classList.toggle('hidden', !isLogin)
            panelSignup.classList.toggle('hidden', isLogin)
            hideMsg()
        }
        tabLogin.addEventListener('click', () => setTab('login'))
        tabSignup.addEventListener('click', () => setTab('signup'))

        // Messages
        const successBox = document.getElementById('success-message')
        const errorBox = document.getElementById('error-message')
        const showSuccess = (m) => { successBox.textContent = m; successBox.classList.remove('hidden'); errorBox.classList.add('hidden') }
        const showError = (m) => { errorBox.textContent = m; errorBox.classList.remove('hidden'); successBox.classList.add('hidden') }
        const hideMsg = () => { successBox.classList.add('hidden'); errorBox.classList.add('hidden') }

        // Password toggles
        function togglePassword(btnId, inputId) {
            const btn = document.getElementById(btnId)
            const input = document.getElementById(inputId)
            btn.addEventListener('click', () => {
                const isPwd = input.type === 'password'
                input.type = isPwd ? 'text' : 'password'
                btn.innerHTML = isPwd ? '<i class="far fa-eye-slash"></i>' : '<i class="far fa-eye"></i>'
            })
        }
        togglePassword('login-toggle-pass', 'login-password')
        togglePassword('signup-toggle-pass', 'signup-password')

        // Login
        document.getElementById('panel-login').addEventListener('submit', async (e) => {
            e.preventDefault(); hideMsg()
            const email = document.getElementById('login-email').value.trim()
            const password = document.getElementById('login-password').value
            const { data, error } = await supabaseClient.auth.signInWithPassword({ email, password })
            if (error) { showError(error.message); return }
            sessionStorage.setItem('supabase_session', JSON.stringify(data.session))
            // Backstop: ensure profile exists with default role
            try { await supabaseClient.from('profiles').upsert({ id: data.user.id, email, role: 'supporter' }, { onConflict: 'id' }) } catch { }
            window.location.href = '/dashboard.html'
        })

        // Forgot password
        document.getElementById('forgot').addEventListener('click', async () => {
            const email = document.getElementById('login-email').value.trim()
            if (!email) { showError('Enter your email above, then click again.'); return }
            const redirectTo = `${window.location.origin}/reset.html`
            const { error } = await supabaseClient.auth.resetPasswordForEmail(email, { redirectTo })
            if (error) { showError(error.message); return }
            showSuccess('Password reset email sent. Check your inbox.')
        })

        // Google OAuth
        async function signInWithGoogle() {
            const redirectTo = `${window.location.origin}/dashboard.html`
            const { error } = await supabaseClient.auth.signInWithOAuth({ provider: 'google', options: { redirectTo } })
            if (error) showError(error.message)
        }
        document.getElementById('login-google').addEventListener('click', signInWithGoogle)
        document.getElementById('signup-google').addEventListener('click', signInWithGoogle)

        // Signup
        document.getElementById('panel-signup').addEventListener('submit', async (e) => {
            e.preventDefault(); hideMsg()
            const email = document.getElementById('signup-email').value.trim()
            const password = document.getElementById('signup-password').value
            const emailRedirectTo = `${window.location.origin}/login.html`
            const { data, error } = await supabaseClient.auth.signUp({
                email, password, options: { data: { role: 'supporter' }, emailRedirectTo }
            })
            if (error) { showError(error.message); return }
            try { await supabaseClient.from('profiles').upsert({ id: data.user?.id, email, role: 'supporter' }) } catch { }
            setTab('login'); showSuccess('Sign up successful. Confirm your email, then log in.')
        })

            // If already logged in, bounce to dashboard
            (async () => {
                const { data } = await supabaseClient.auth.getSession()
                if (data.session) {
                    sessionStorage.setItem('supabase_session', JSON.stringify(data.session))
                    window.location.href = '/dashboard.html'
                }
            })()

        // Header: mobile menu + dropdowns + auth link text
        function wireHeader() {
            const mobileMenuBtn = document.getElementById('mobile-menu-btn')
            const mobileMenu = document.getElementById('mobile-menu')
            mobileMenuBtn?.addEventListener('click', () => mobileMenu.classList.toggle('hidden'))

            document.addEventListener('click', (e) => {
                const isToggle = e.target.matches('[data-toggle="dropdown"]')
                if (!isToggle && e.target.closest('.dropdown') === null) {
                    document.querySelectorAll('.dropdown-menu').forEach(m => m.classList.add('hidden'))
                    return
                }
                if (isToggle) {
                    e.preventDefault(); e.target.nextElementSibling?.classList.toggle('hidden')
                }
            })

            const authLink = document.getElementById('auth-link')
            const mobileAuthLink = document.getElementById('mobile-auth-link')
            const isLoggedIn = sessionStorage.getItem('supabase_session')
            if (isLoggedIn) {
                if (authLink) { authLink.href = '/dashboard.html'; authLink.textContent = 'Dashboard' }
                if (mobileAuthLink) { mobileAuthLink.href = '/dashboard.html'; mobileAuthLink.textContent = 'Dashboard' }
            } else {
                if (authLink) { authLink.href = '/login.html'; authLink.textContent = 'Login' }
                if (mobileAuthLink) { mobileAuthLink.href = '/login.html'; mobileAuthLink.textContent = 'Login' }
            }
        }
        wireHeader()
    </script>
</body>

</html>